<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>护照上传 | 1211 World</title>
  <style>
    body {
      font-family: 'Noto Sans SC', 'Noto Sans JP', sans-serif;
      background-color: #f3f3f3;
      color: #333;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .form-container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      width: 100%;
      max-width: 600px;
    }

    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #444;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: 500;
      color: #555;
    }

    input[type="text"],
    input[type="date"],
    input[type="file"] {
      width: 100%;
      padding: 0.6rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-top: 0.3rem;
      background-color: #fafafa;
      transition: border 0.2s;
    }

    input:focus {
      border-color: #999;
      outline: none;
    }

    .guest-group {
      background-color: #f8f8f8;
      padding: 1rem;
      border-radius: 12px;
      margin-top: 1rem;
    }

    .add-btn {
      margin-top: 1rem;
      background-color: #666;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .add-btn:hover {
      background-color: #555;
    }

    .submit-btn {
      width: 100%;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 0.8rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1.5rem;
      transition: background-color 0.3s;
    }

    .submit-btn:hover {
      background-color: #333;
    }

    .lang-toggle {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
    }

    .lang-toggle button {
      margin-left: 0.3rem;
      background: none;
      border: none;
      color: #444;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .lang-toggle button.active {
      font-weight: bold;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="lang-toggle">
    <button data-lang="zh" class="active">中文</button>
    <button data-lang="ja">日本語</button>
    <button data-lang="en">English</button>
  </div>

  <div class="form-container">
    <h2 id="title">护照上传表单</h2>
    <form id="passportForm" enctype="multipart/form-data">
      <label id="label-main">预订人姓名</label>
      <input type="text" id="mainName" name="mainName" required>

      <label id="label-dates">入住日期（到达日 - 离开日）</label>
      <div style="display:flex; gap:0.5rem;">
        <input type="date" id="checkin" name="checkin" required style="flex:1;">
        <input type="date" id="checkout" name="checkout" required style="flex:1;">
      </div>

      <label id="label-room">房间号 / 房源名</label>
      <input type="text" id="roomName" name="roomName" required>

      <div id="guests"></div>

      <button type="button" class="add-btn" id="addGuest">＋ 添加房客信息</button>

      <button type="submit" class="submit-btn" id="submitBtn">提交</button>
    </form>
  </div>

  <script>
    const langData = {
      zh: {
        title: "护照上传表单",
        main: "预订人姓名",
        dates: "入住日期（到达日 - 离开日）",
        room: "房间号 / 房源名",
        guestName: "房客姓名",
        guestPassport: "护照照片",
        add: "＋ 添加房客信息",
        submit: "提交"
      },
      ja: {
        title: "パスポートアップロードフォーム",
        main: "予約者氏名",
        dates: "宿泊日（チェックイン - チェックアウト）",
        room: "部屋番号 / 宿泊施設名",
        guestName: "宿泊者氏名",
        guestPassport: "パスポート写真",
        add: "＋ 宿泊者を追加",
        submit: "送信"
      },
      en: {
        title: "Passport Upload Form",
        main: "Booking Name",
        dates: "Stay Dates (Check-in - Check-out)",
        room: "Room Number / Property Name",
        guestName: "Guest Name",
        guestPassport: "Passport Photo",
        add: "＋ Add Guest Info",
        submit: "Submit"
      }
    };

    const form = document.getElementById('passportForm');
    const addGuestBtn = document.getElementById('addGuest');
    const guestsContainer = document.getElementById('guests');
    const langButtons = document.querySelectorAll('.lang-toggle button');
    let currentLang = 'zh';
    let guestCount = 0;

    langButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        currentLang = btn.dataset.lang;
        langButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyLang();
      });
    });

    function applyLang() {
      const t = langData[currentLang];
      document.getElementById('title').innerText = t.title;
      document.getElementById('label-main').innerText = t.main;
      document.getElementById('label-dates').innerText = t.dates;
      document.getElementById('label-room').innerText = t.room;
      addGuestBtn.innerText = t.add;
      document.getElementById('submitBtn').innerText = t.submit;
      document.querySelectorAll('.guest-group label.name').forEach(l => l.innerText = t.guestName);
      document.querySelectorAll('.guest-group label.passport').forEach(l => l.innerText = t.guestPassport);
    }

    addGuestBtn.addEventListener('click', () => {
      const t = langData[currentLang];
      const div = document.createElement('div');
      div.className = 'guest-group';
      div.innerHTML = `
        <label class="name">${t.guestName}</label>
        <input type="text" name="guest_${guestCount}_name" required>
        <label class="passport">${t.guestPassport}</label>
        <input type="file" name="guest_${guestCount}_passport" accept="image/*" required>
      `;
      guestsContainer.appendChild(div);
      guestCount++;
    });

    async function compressImage(file) {
      return new Promise((resolve) => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = (e) => {
          img.src = e.target.result;
        };
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const maxW = 1280;
          const scale = Math.min(1, maxW / img.width);
          canvas.width = img.width * scale;
          canvas.height = img.height * scale;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          canvas.toBlob(
            (blob) => resolve(blob),
            'image/jpeg',
            0.7
          );
        };
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append('mainName', document.getElementById('mainName').value);
      formData.append('checkin', document.getElementById('checkin').value);
      formData.append('checkout', document.getElementById('checkout').value);
      formData.append('roomName', document.getElementById('roomName').value);

      const files = form.querySelectorAll('input[type="file"]');
      for (const fileInput of files) {
        const file = fileInput.files[0];
        if (file) {
          const compressed = await compressImage(file);
          formData.append(fileInput.name, compressed, file.name);
        }
      }

      const res = await fetch('https://script.google.com/macros/s/AKfycbwYd-1ceBFUDBhy68toNX-dMRjwbC0LVAHsVE_NUPEMGN4YvxOINL4KqWXwh_xYQZ9h-Q/exec', {
        method: 'POST',
        body: formData
      });

      if (res.ok) {
        alert('✅ 提交成功 / 送信しました / Submitted successfully');
        form.reset();
        guestsContainer.innerHTML = '';
        guestCount = 0;
      } else {
        alert('❌ 提交失败，请重试 / 送信エラー / Submission failed');
      }
    });

    applyLang();
  </script>
</body>
</html>
